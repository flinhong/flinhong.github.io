/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
window.rangy=function(){function e(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function t(e,t){return!("object"!=typeof e[t]||!e[t])}function n(e,t){return"undefined"!=typeof e[t]}function o(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}function r(e){return e&&h(e,u)&&g(e,f)}function i(e){window.alert("Rangy not supported in your browser. Reason: "+e),p.initialized=!0,p.supported=!1}function a(){if(!p.initialized){var n,o=!1,a=!1;for(e(document,"createRange")&&(n=document.createRange(),h(n,d)&&g(n,c)&&(o=!0),n.detach()),(n=t(document,"body")?document.body:document.getElementsByTagName("body")[0])&&e(n,"createTextRange")&&(n=n.createTextRange(),r(n)&&(a=!0)),!o&&!a&&i("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:o,implementsTextRange:a},o=C.concat(m),a=0,n=o.length;n>a;++a)try{o[a](p)}catch(s){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",s)}}}function s(e){this.name=e,this.supported=this.initialized=!1}var c=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],d=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],u=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],h=o(e),l=o(t),g=o(n),p={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:h,areHostObjects:l,areHostProperties:g,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=i,p.warn=function(e){e="Rangy warning: "+e,p.config.alertOnWarn?window.alert(e):"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(e)},{}.hasOwnProperty?p.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:i("hasOwnProperty not supported");var m=[],C=[];p.init=a,p.addInitListener=function(e){p.initialized?e(p):m.push(e)};var R=[];p.addCreateMissingNativeApiListener=function(e){R.push(e)},p.createMissingNativeApi=function(e){e=e||window,a();for(var t=0,n=R.length;n>t;++t)R[t](e)},s.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},s.prototype.warn=function(e){p.warn("Module "+this.name+": "+e)},s.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)},p.createModule=function(e,t){var n=new s(e);p.modules[e]=n,C.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},p.requireModules=function(e){for(var t,n,o=0,r=e.length;r>o;++o){if(n=e[o],t=p.modules[n],!(t&&t instanceof s))throw Error("Module '"+n+"' not found");if(!t.supported)throw Error("Module '"+n+"' not supported")}};var N=!1;if(l=function(){N||(N=!0,p.initialized||a())},"undefined"==typeof window)i("No window found");else{if("undefined"!=typeof document)return e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",l,!1),e(window,"addEventListener")?window.addEventListener("load",l,!1):e(window,"attachEvent")?window.attachEvent("onload",l):i("Window does not have required addEventListener or attachEvent method"),p;i("No document found")}}(),rangy.createModule("DomUtil",function(e,t){function n(e){for(var t=0;e=e.previousSibling;)t++;return t}function o(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(g(o,n))return n;return null}function r(e,t,n){for(n=n?e:e.parentNode;n;){if(e=n.parentNode,e===t)return n;n=e}return null}function i(e){return e=e.nodeType,3==e||4==e||8==e}function a(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function s(e){if(9==e.nodeType)return e;if("undefined"!=typeof e.ownerDocument)return e.ownerDocument;if("undefined"!=typeof e.document)return e.document;if(e.parentNode)return s(e.parentNode);throw Error("getDocument: no document found for node")}function c(e){return e?i(e)?'"'+e.data+'"':1==e.nodeType?"<"+e.nodeName+(e.id?' id="'+e.id+'"':"")+">["+e.childNodes.length+"]":e.nodeName:"[No node]"}function d(e){this._next=this.root=e}function f(e,t){this.node=e,this.offset=t}function u(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var h=e.util;h.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),h.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var l=document.createElement("div");h.areHostMethods(l,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation"),h.isHostProperty(l,"innerHTML")||t.fail("Element is missing innerHTML property"),l=document.createTextNode("test"),h.areHostMethods(l,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");var g=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};d.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t=this._current=this._next;if(this._current)if(e=t.firstChild)this._next=e;else{for(e=null;t!==this.root&&!(e=t.nextSibling);)t=t.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}},f.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+c(this.node)+":"+this.offset+")]"}},u.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},u.prototype.toString=function(){return this.message},e.dom={arrayContains:g,isHtmlNamespace:function(e){var t;return"undefined"==typeof e.namespaceURI||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){return e=e.parentNode,1==e.nodeType?e:null},getNodeIndex:n,getNodeLength:function(e){var t;return i(e)?e.length:(t=e.childNodes)?t.length:0},getCommonAncestor:o,isAncestorOf:function(e,t,n){for(t=n?t:t.parentNode;t;){if(t===e)return!0;t=t.parentNode}return!1},getClosestAncestorIn:r,isCharacterDataNode:i,insertAfter:a,splitDataNode:function(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),a(n,e),n},getDocument:s,getWindow:function(e){if(e=s(e),"undefined"!=typeof e.defaultView)return e.defaultView;if("undefined"!=typeof e.parentWindow)return e.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(e){if("undefined"!=typeof e.contentWindow)return e.contentWindow;if("undefined"!=typeof e.contentDocument)return e.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(e){if("undefined"!=typeof e.contentDocument)return e.contentDocument;if("undefined"!=typeof e.contentWindow)return e.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(e){return h.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,i,a){var s;if(e==i)return t===a?0:a>t?-1:1;if(s=r(i,e,!0))return t<=n(s)?-1:1;if(s=r(e,i,!0))return n(s)<a?-1:1;if(t=o(e,i),e=e===t?t:r(e,t,!0),i=i===t?t:r(i,t,!0),e===i)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(t=t.firstChild;t;){if(t===e)return-1;if(t===i)return 1;t=t.nextSibling}throw Error("Should not be here!")},inspectNode:c,fragmentFromNodeChildren:function(e){for(var t,n=s(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new d(e)},DomPosition:f},e.DOMException=u}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(H.isAncestorOf(e,t.startContainer,!0)||H.isAncestorOf(e,t.endContainer,!0))}function n(e){return H.getDocument(e.startContainer)}function o(e,t,n){if(t=e._listeners[t])for(var o=0,r=t.length;r>o;++o)t[o].call(e,{target:e,args:n})}function r(e){return new M(e.parentNode,H.getNodeIndex(e))}function i(e){return new M(e.parentNode,H.getNodeIndex(e)+1)}function a(e,t,n){var o=11==e.nodeType?e.firstChild:e;return H.isCharacterDataNode(t)?n==t.length?H.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:H.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function s(e){for(var t,o,r=n(e.range).createDocumentFragment();o=e.next();){if(t=e.isPartiallySelectedSubtree(),o=o.cloneNode(!t),t&&(t=e.getSubtreeIterator(),o.appendChild(s(t)),t.detach(!0)),10==o.nodeType)throw new B("HIERARCHY_REQUEST_ERR");r.appendChild(o)}return r}function c(e,t,n){var o,r;for(n=n||{stop:!1};o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(n.stop=!0);if(o=e.getSubtreeIterator(),c(o,t,n),o.detach(!0),n.stop)return}else for(o=H.createIterator(o);r=o.next();)if(t(r)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function f(e){for(var t,o,r=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),o=e.getSubtreeIterator(),t.appendChild(f(o)),o.detach(!0)):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function u(e,t,n){var o,r=!(!t||!t.length),i=!!n;r&&(o=RegExp("^("+t.join("|")+")$"));var a=[];return c(new l(e,!1),function(e){r&&!o.test(e.nodeType)||i&&!n(e)||a.push(e)}),a}function h(e){return"["+("undefined"==typeof e.getName?"Range":e.getName())+"("+H.inspectNode(e.startContainer)+":"+e.startOffset+", "+H.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function l(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&H.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||H.isCharacterDataNode(this.sc)?H.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||H.isCharacterDataNode(this.ec)?H.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function p(e,t,n){this.nodes=u(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var o,r=n?t:t.parentNode;r;){if(o=r.nodeType,H.arrayContains(e,o))return r;r=r.parentNode}return null}}function C(e,t){if(Y(e,t))throw new g("INVALID_NODE_TYPE_ERR")}function R(e){if(!e.startContainer)throw new B("INVALID_STATE_ERR")}function N(e,t){if(!H.arrayContains(t,e.nodeType))throw new g("INVALID_NODE_TYPE_ERR")}function v(e,t){if(0>t||t>(H.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function E(e,t){if(j(e,!0)!==j(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function _(e){if(q(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function S(e,t){if(!e)throw new B(t)}function O(e){return!!e.startContainer&&!!e.endContainer&&!(!H.arrayContains(W,e.startContainer.nodeType)&&!j(e.startContainer,!0))&&!(!H.arrayContains(W,e.endContainer.nodeType)&&!j(e.endContainer,!0))&&e.startOffset<=(H.isCharacterDataNode(e.startContainer)?e.startContainer.length:e.startContainer.childNodes.length)&&e.endOffset<=(H.isCharacterDataNode(e.endContainer)?e.endContainer.length:e.endContainer.childNodes.length)}function w(e){if(R(e),!O(e))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function y(){}function T(e){e.START_TO_START=X,e.START_TO_END=Z,e.END_TO_END=$,e.END_TO_START=J,e.NODE_BEFORE=K,e.NODE_AFTER=ee,e.NODE_BEFORE_AND_AFTER=te,e.NODE_INSIDE=ne}function D(e){T(e),T(e.prototype)}function x(e,t){return function(){w(this);var n=this.startContainer,o=this.startOffset,r=this.commonAncestorContainer,a=new l(this,!0);return n!==r&&(n=H.getClosestAncestorIn(n,r,!0),o=i(n),n=o.node,o=o.offset),c(a,_),a.reset(),r=e(a),a.detach(),t(this,n,o,n,o),r}}function A(n,o,a){function s(e,t){return function(n){R(this),N(n,L),N(V(n),W),n=(e?r:i)(n),(t?c:u)(this,n.node,n.offset)}}function c(e,t,n){var r=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((V(t)!=V(r)||1==H.comparePoints(t,n,r,i))&&(r=t,i=n),o(e,t,n,r,i))}function u(e,t,n){var r=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((V(t)!=V(r)||-1==H.comparePoints(t,n,r,i))&&(r=t,i=n),o(e,r,i,t,n))}n.prototype=new y,e.util.extend(n.prototype,{setStart:function(e,t){R(this),C(e,!0),v(e,t),c(this,e,t)},setEnd:function(e,t){R(this),C(e,!0),v(e,t),u(this,e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){w(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(this),C(e,!0),o(this,e,0,e,H.getNodeLength(e))},selectNode:function(e){R(this),C(e,!1),N(e,L);var t=r(e);e=i(e),o(this,t.node,t.offset,e.node,e.offset)},extractContents:x(f,o),deleteContents:x(d,o),canSurroundContents:function(){w(this),_(this.startContainer),_(this.endContainer);var e=new l(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){a(this)},splitBoundaries:function(){w(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,i=e===n;H.isCharacterDataNode(n)&&r>0&&r<n.length&&H.splitDataNode(n,r),H.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=H.splitDataNode(e,t),i?(r-=t,n=e):n==e.parentNode&&r>=H.getNodeIndex(e)&&r++,t=0),o(this,e,t,n,r)},normalizeBoundaries:function(){w(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(o){var i=o.previousSibling;if(i&&i.nodeType==o.nodeType){e=o;var a=o.length;t=i.length,o.insertData(0,i.data),i.parentNode.removeChild(i),e==n?(r+=t,n=e):n==o.parentNode&&(i=H.getNodeIndex(o),r==i?(n=o,r=a):r>i&&r--)}},s=!0;H.isCharacterDataNode(n)?n.length==r&&i(n):(r>0&&(s=n.childNodes[r-1])&&H.isCharacterDataNode(s)&&i(s),s=!this.collapsed),s?H.isCharacterDataNode(e)?0==t&&a(e):t<e.childNodes.length&&(i=e.childNodes[t])&&H.isCharacterDataNode(i)&&a(i):(e=n,t=r),o(this,e,t,n,r)},collapseToPoint:function(e,t){R(this),C(e,!0),v(e,t),(e!==this.startContainer||t!==this.startOffset||e!==this.endContainer||t!==this.endOffset)&&o(this,e,t,e,t)}}),D(n)}function I(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:H.getCommonAncestor(e.startContainer,e.endContainer)}function P(e,t,n,r,i){var a=e.startContainer!==t||e.startOffset!==n,s=e.endContainer!==r||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,I(e),o(e,"boundarychange",{startMoved:a,endMoved:s})}function b(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},I(this)}e.requireModules(["DomUtil"]);var H=e.dom,M=H.DomPosition,B=e.DOMException;l.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,H.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!H.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){return t(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new b(n(this.range));var t=this._current,o=t,r=0,i=t,a=H.getNodeLength(t);H.isAncestorOf(t,this.sc,!0)&&(o=this.sc,r=this.so),H.isAncestorOf(t,this.ec,!0)&&(i=this.ec,a=this.eo),P(e,o,r,i,a)}return new l(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},g.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},g.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var L=[1,3,4,5,7,8,10],W=[2,9,11],F=[1,3,4,5,7,8,10,11],U=[1,3,4,5,7,8],V=H.getRootContainer,j=m([9,11]),q=m([5,6,10,12]),Y=m([6,10,12]),k=document.createElement("style"),z=!1;try{k.innerHTML="<b>x</b>",z=3==k.firstChild.nodeType}catch(Q){}e.features.htmlParsingConforms=z;var G=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],X=0,Z=1,$=2,J=3,K=0,ee=1,te=2,ne=3;y.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){w(this),E(this.startContainer,t.startContainer);var n=e==J||e==X?"start":"end",o=e==Z||e==X?"start":"end";return H.comparePoints(this[n+"Container"],this[n+"Offset"],t[o+"Container"],t[o+"Offset"])},insertNode:function(e){if(w(this),N(e,F),_(this.startContainer),H.isAncestorOf(e,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");this.setStartBefore(a(e,this.startContainer,this.startOffset))},cloneContents:function(){w(this);var e,t;return this.collapsed?n(this).createDocumentFragment():this.startContainer===this.endContainer&&H.isCharacterDataNode(this.startContainer)?(e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t):(t=new l(this,!0),e=s(t),t.detach(),e)},canSurroundContents:function(){w(this),_(this.startContainer),_(this.endContainer);var e=new l(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(N(e,U),!this.canSurroundContents())throw new g("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this);for(var e,t=new b(n(this)),o=G.length;o--;)e=G[o],t[e]=this[e];return t},toString:function(){w(this);var e=this.startContainer;if(e===this.endContainer&&H.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[];return e=new l(this,!0),c(e,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),e.detach(),t.join("")},compareNode:function(e){w(this);var t=e.parentNode,n=H.getNodeIndex(e);if(!t)throw new B("NOT_FOUND_ERR");return e=this.comparePoint(t,n),t=this.comparePoint(t,n+1),0>e?t>0?te:K:t>0?ee:ne},comparePoint:function(e,t){return w(this),S(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),H.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:H.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:z?function(e){var t=this.startContainer,n=H.getDocument(t);if(!t)throw new B("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:H.isCharacterDataNode(t)&&(o=H.parentElement(t)),o=null===o||"HTML"==o.nodeName&&H.isHtmlNamespace(H.getDocument(o).documentElement)&&H.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=e,H.fragmentFromNodeChildren(o)}:function(e){R(this);var t=n(this).createElement("body");return t.innerHTML=e,H.fragmentFromNodeChildren(t)},toHtml:function(){w(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(w(this),S(e,"NOT_FOUND_ERR"),H.getDocument(e)!==n(this))return!1;var o=e.parentNode,r=H.getNodeIndex(e);S(o,"NOT_FOUND_ERR");var i=H.comparePoints(o,r,this.endContainer,this.endOffset);return o=H.comparePoints(o,r+1,this.startContainer,this.startOffset),t?0>=i&&o>=0:0>i&&o>0},isPointInRange:function(e,t){return w(this),S(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),H.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&H.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(w(this),n(e)!=n(this))throw new B("WRONG_DOCUMENT_ERR");var o=H.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=H.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=o&&r>=0:0>o&&r>0},intersection:function(e){if(this.intersectsRange(e)){var t=H.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=H.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==H.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==H.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new g("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ne},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,H.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);return n.length>0?(t.setStart(n[0],0),e=n.pop(),t.setEnd(e,e.length),e=this.containsRange(t),t.detach(),e):this.containsNodeContents(e)},createNodeIterator:function(e,t){return w(this),new p(this,e,t)},getNodes:function(e,t){return w(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){R(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){R(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return b.rangesEqual(this,e)},isValid:function(){return O(this)},inspect:function(){return h(this)}},A(b,P,function(e){R(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,o(e,"detach",null),e._listeners=null}),e.rangePrototype=y.prototype,b.rangeProperties=G,b.RangeIterator=l,b.copyComparisonConstants=D,b.createPrototypeRange=A,b.inspect=h,b.getRangeDocument=n,b.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=b,e.RangeException=g}),rangy.createModule("WrappedRange",function(e){function t(e,t,n,o){var a=e.duplicate();a.collapse(n);var s=a.parentElement();if(r.isAncestorOf(t,s,!0)||(s=t),!s.canHaveHTML)return new i(s.parentNode,r.getNodeIndex(s));t=r.getDocument(s).createElement("span");var c,d=n?"StartToStart":"StartToEnd";do s.insertBefore(t,t.previousSibling),a.moveToElementText(t);while((c=a.compareEndPoints(d,e))>0&&t.previousSibling);if(d=t.nextSibling,-1==c&&d&&r.isCharacterDataNode(d)){if(a.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(d.data))for(s=a.duplicate(),n=s.text.replace(/\r\n/g,"\r").length,n=s.moveStart("character",n);-1==s.compareEndPoints("StartToEnd",s);)n++,s.moveStart("character",1);else n=a.text.length;s=new i(d,n)}else d=(o||!n)&&t.previousSibling,s=(n=(o||n)&&t.nextSibling)&&r.isCharacterDataNode(n)?new i(n,0):d&&r.isCharacterDataNode(d)?new i(d,d.length):new i(s,r.getNodeIndex(t));return t.parentNode.removeChild(t),s}function n(e,t){var n,o,i=e.offset,a=r.getDocument(e.node),s=a.body.createTextRange(),c=r.isCharacterDataNode(e.node);return c?(n=e.node,o=n.parentNode):(n=e.node.childNodes,n=i<n.length?n[i]:null,o=e.node),a=a.createElement("span"),a.innerHTML="&#feff;",n?o.insertBefore(a,n):o.appendChild(a),s.moveToElementText(a),s.collapse(!t),o.removeChild(a),c&&s[t?"moveStart":"moveEnd"]("character",i),s}e.requireModules(["DomUtil","DomRange"]);var o,r=e.dom,i=r.DomPosition,a=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){o=function(e){this.textRange=e,this.refresh()},o.prototype=new a(document),o.prototype.refresh=function(){var e,n,o=this.textRange;e=o.parentElement();var i=o.duplicate();i.collapse(!0),n=i.parentElement(),i=o.duplicate(),i.collapse(!1),o=i.parentElement(),n=n==o?n:r.getCommonAncestor(n,o),n=n==e?n:r.getCommonAncestor(e,n),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?n=e=t(this.textRange,n,!0,!0):(e=t(this.textRange,n,!0,!1),n=t(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(n.node,n.offset)},a.copyComparisonConstants(o);var s=function(){return this}();"undefined"==typeof s.Range&&(s.Range=o),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,n=c.length;n--;)t=c[n],e[t]=e.nativeRange[t]}var n,i,s,c=a.rangeProperties;o=function(e){if(!e)throw Error("Range must be specified");this.nativeRange=e,t(this)},a.createPrototypeRange(o,function(e,t,n,o,r){var i=e.endContainer!==o||e.endOffset!=r;(e.startContainer!==t||e.startOffset!=n||i)&&(e.setEnd(o,r),e.setStart(t,n))},function(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=c.length;n--;)t=c[n],e[t]=null}),n=o.prototype,n.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},n.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},n.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},n.cloneContents=function(){return this.nativeRange.cloneContents()},n.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},n.collapse=function(e){this.nativeRange.collapse(e),t(this)},n.cloneRange=function(){return new o(this.nativeRange.cloneRange())},n.refresh=function(){t(this)},n.toString=function(){return this.nativeRange.toString()};var d=document.createTextNode("test");r.getBody(document).appendChild(d);var f=document.createRange();f.setStart(d,0),f.setEnd(d,0);try{f.setStart(d,1),i=!0,n.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},n.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},s=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(u){i=!1,n.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(o){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},n.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(o){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},s=function(e,n){return function(o){try{this.nativeRange[e](o)}catch(r){this.nativeRange[n](o),this.nativeRange[e](o)}t(this)}}}n.setStartBefore=s("setStartBefore","setEndBefore"),n.setStartAfter=s("setStartAfter","setEndAfter"),n.setEndBefore=s("setEndBefore","setStartBefore"),n.setEndAfter=s("setEndAfter","setStartAfter"),f.selectNodeContents(d),n.selectNodeContents=f.startContainer==d&&f.endContainer==d&&0==f.startOffset&&f.endOffset==d.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,a.getEndOffset(e))},f.selectNodeContents(d),f.setEnd(d,3),i=document.createRange(),i.selectNodeContents(d),i.setEnd(d,4),i.setStart(d,2),n.compareBoundaryPoints=-1==f.compareBoundaryPoints(f.START_TO_END,i)&1==f.compareBoundaryPoints(f.END_TO_START,i)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(f,"createContextualFragment")&&(n.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(d),f.detach(),i.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(o.rangeToTextRange=function(e){if(e.collapsed)return n(new i(e.startContainer,e.startOffset),!0);var t=n(new i(e.startContainer,e.startOffset),!0),o=n(new i(e.endContainer,e.endOffset),!1);return e=r.getDocument(e.startContainer).body.createTextRange(),e.setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",o),e}),o.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=o,e.createRange=function(t){return t=t||document,new o(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new a(e)},e.createIframeRange=function(t){return e.createRange(r.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(r.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){t=t.document,"undefined"==typeof t.createRange&&(t.createRange=function(){return e.createRange(this)}),t=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function o(e){return(e||window).document.selection}function r(e,t,n){var o=n?"end":"start";n=n?"start":"end",e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function i(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var n;return t instanceof N?(n=t._selectionNativeRange,n||(n=e.createNativeRange(C.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof v?n=t.nativeRange:e.features.implementsDomRange&&t instanceof C.getWindow(t.startContainer).Range&&(n=t),n}function s(e){var t,n=e.getNodes();e:if(n.length&&1==n[0].nodeType){t=1;for(var o=n.length;o>t;++t)if(!C.isAncestorOf(n[0],n[t])){t=!1;break e}t=!0}else t=!1;if(!t)throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function c(e,t){var n=new v(t);e._ranges=[n],r(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function d(t){if(t._ranges.length=0,"None"==t.docSelection.type)i(t);else{var n=t.docSelection.createRange();if(n&&"undefined"!=typeof n.text)c(t,n);else{t.rangeCount=n.length;for(var o,a=C.getDocument(n.item(0)),s=0;s<t.rangeCount;++s)o=e.createRange(a),o.selectNode(n.item(s)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,r(t,t._ranges[t.rangeCount-1],!1)}}}function f(e,t){var n=e.docSelection.createRange(),o=s(t),r=C.getDocument(n.item(0));r=C.getBody(r).createControlRange();for(var i=0,a=n.length;a>i;++i)r.add(n.item(i));try{r.add(o)}catch(c){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),d(e)}function u(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function h(e,t){var n=C.getDocument(t[0].startContainer);n=C.getBody(n).createControlRange();for(var o,r=0;r<rangeCount;++r){o=s(t[r]);try{n.add(o)}catch(i){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}n.select(),d(e)}function l(e,t){if(e.anchorNode&&C.getDocument(e.anchorNode)!==C.getDocument(t))throw new E("WRONG_DOCUMENT_ERR")}function g(e){var t=[],n=new _(e.anchorNode,e.anchorOffset),o=new _(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=N.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),
e.config.checkSelectionRanges=!0;var p,m,C=e.dom,R=e.util,N=e.DomRange,v=e.WrappedRange,E=e.DOMException,_=C.DomPosition,S=e.util.isHostMethod(window,"getSelection"),O=e.util.isHostObject(document,"selection"),w=O&&(!S||e.config.preferTextRange);w?(p=o,e.isSelectionValid=function(e){e=(e||window).document;var t=e.selection;return"None"!=t.type||C.getDocument(t.createRange().parentElement())==e}):S?(p=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=p,S=p();var y=e.createNativeRange(document),T=C.getBody(document),D=R.areHostObjects(S,R.areHostProperties(S,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=D;var x=R.isHostMethod(S,"extend");e.features.selectionHasExtend=x;var A="number"==typeof S.rangeCount;e.features.selectionHasRangeCount=A;var I=!1,P=!0;R.areHostMethods(S,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof S.rangeCount&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",T.appendChild(e);var t=C.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=C.getIframeWindow(e).getSelection(),o=t.documentElement.lastChild.firstChild;t=t.createRange(),t.setStart(o,1),t.collapse(!0),n.addRange(t),P=1==n.rangeCount,n.removeAllRanges();var r=t.cloneRange();t.setStart(o,0),r.setEnd(o,2),n.addRange(t),n.addRange(r),I=2==n.rangeCount,t.detach(),r.detach(),T.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=I,e.features.collapsedNonEditableSelectionsSupported=P;var b,H=!1;T&&R.isHostMethod(T,"createControlRange")&&(b=T.createControlRange(),R.areHostProperties(b,["item","add"])&&(H=!0)),e.features.implementsControlRange=H,m=D?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var M;if(R.isHostMethod(S,"getRangeAt")?M=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:D&&(M=function(t){var n=C.getDocument(t.anchorNode);return n=e.createRange(n),n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){e=e||window;var t=e._rangySelection,n=p(e),r=O?o(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh(e)):(t=new u(n,r,e),e._rangySelection=t),t},e.getIframeSelection=function(t){return e.getSelection(C.getIframeWindow(t))},b=u.prototype,!w&&D&&R.areHostMethods(S,["removeAllRanges","addRange"])){b.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),i(this)};var B=function(t,n){var o=N.getRangeDocument(n);o=e.createRange(o),o.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(a(o)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};b.addRange=A?function(t,n){if(H&&O&&"Control"==this.docSelection.type)f(this,t);else if(n&&x)B(this,t);else{var o;I?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1?(e.config.checkSelectionRanges&&(o=M(this.nativeSelection,this.rangeCount-1))&&!N.rangesEqual(o,t)&&(t=new v(o)),this._ranges[this.rangeCount-1]=t,r(this,t,F(this.nativeSelection)),this.isCollapsed=m(this)):this.refresh()}}:function(e,t){t&&x?B(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},b.setRanges=function(e){if(H&&e.length>1)h(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(R.isHostMethod(S,"empty")&&R.isHostMethod(y,"select")&&H&&w))return t.fail("No means of selecting a Range or TextRange was found"),!1;b.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=C.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=C.getDocument(t.item(0)).body.createTextRange())}e&&(e.body.createTextRange().select(),this.docSelection.empty())}}catch(n){}i(this)},b.addRange=function(e){"Control"==this.docSelection.type?f(this,e):(v.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,e,!1))},b.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?h(this,e):t&&this.addRange(e[0])}}b.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new E("INDEX_SIZE_ERR");return this._ranges[e]};var L;if(w)L=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=C.getBody(t.win.document).createTextRange(),n.collapse(!0)),"Control"==t.docSelection.type?d(t):n&&"undefined"!=typeof n.text?c(t,n):i(t)};else if(R.isHostMethod(S,"getRangeAt")&&"number"==typeof S.rangeCount)L=function(t){if(H&&O&&"Control"==t.docSelection.type)d(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;o>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));r(t,t._ranges[t.rangeCount-1],F(t.nativeSelection)),t.isCollapsed=m(t)}else i(t)};else{if(!D||"boolean"!=typeof S.isCollapsed||"boolean"!=typeof y.collapsed||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;L=function(e){var t;t=e.nativeSelection,t.anchorNode?(t=M(t,0),e._ranges=[t],e.rangeCount=1,t=e.nativeSelection,e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset,e.isCollapsed=m(e)):i(e)}}b.refresh=function(e){var t=e?this._ranges.slice(0):null;if(L(this),e){if(e=t.length,e!=this._ranges.length)return!1;for(;e--;)if(!N.rangesEqual(t[e],this._ranges[e]))return!1;return!0}};var W=function(e,t){var n=e.getAllRanges(),o=!1;e.removeAllRanges();for(var r=0,a=n.length;a>r;++r)o||t!==n[r]?e.addRange(n[r]):o=!0;e.rangeCount||i(e)};b.removeRange=H?function(e){if("Control"==this.docSelection.type){var t=this.docSelection.createRange();e=s(e);var n=C.getDocument(t.item(0));n=C.getBody(n).createControlRange();for(var o,r=!1,i=0,a=t.length;a>i;++i)o=t.item(i),o!==e||r?n.add(t.item(i)):r=!0;n.select(),d(this)}else W(this,e)}:function(e){W(this,e)};var F;!w&&D&&e.features.implementsDomRange?(F=function(e){var t=!1;return e.anchorNode&&(t=1==C.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},b.isBackwards=function(){return F(this)}):F=b.isBackwards=function(){return!1},b.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},b.collapse=function(t,n){l(this,t);var o=e.createRange(C.getDocument(t));o.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(o),this.isCollapsed=!0},b.collapseToStart=function(){if(!this.rangeCount)throw new E("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},b.collapseToEnd=function(){if(!this.rangeCount)throw new E("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},b.selectAllChildren=function(t){l(this,t);var n=e.createRange(C.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},b.deleteFromDocument=function(){if(H&&O&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){t=this.getAllRanges(),this.removeAllRanges(),e=0;for(var n=t.length;n>e;++e)t[e].deleteContents();this.addRange(t[n-1])}},b.getAllRanges=function(){return this._ranges.slice(0)},b.setSingleRange=function(e){this.setRanges([e])},b.containsNode=function(e,t){for(var n=0,o=this._ranges.length;o>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},b.toHtml=function(){var e="";if(this.rangeCount){e=N.getRangeDocument(this._ranges[0]).createElement("div");for(var t=0,n=this._ranges.length;n>t;++t)e.appendChild(this._ranges[t].cloneContents());e=e.innerHTML}return e},b.getName=function(){return"WrappedSelection"},b.inspect=function(){return g(this)},b.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null},u.inspect=g,e.Selection=u,e.selectionPrototype=b,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});